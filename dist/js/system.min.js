"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var System=function(e){function o(e,t,r){var n;return _classCallCheck(this,o),(n=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this))).addButton=e,n.wrap=t,n.nameField=r,n.iframes=[],n.invalidName=!1,n}return _inherits(o,Mediator),_createClass(o,[{key:"checkFramesCount",value:function(){return this.iframes.length+1}},{key:"addFrame",value:function(e,t){var r=this,n=new IFrame(t||"iFrame".concat(this.checkFramesCount()),this).renderIframe();this.iframes.push(n),e.append(n),setTimeout(function(){r.publish("receivedMessage",{message:"[system]: ".concat(n.name," joined the conversation"),type:"system"})},300)}},{key:"checkNewName",value:function(){var t=this,e=document.querySelector(".error");this.nameField.addEventListener("input",function(){t.invalidName=t.iframes.some(function(e){return e.name===t.nameField.value.trim()}),t.invalidName?e.classList.add("error--active"):e.classList.remove("error--active")})}},{key:"removeFrame",value:function(t){var e=this.iframes.find(function(e){if(e)return e.name===t});this.iframes.splice(this.iframes.indexOf(e),0,null),this.wrap.removeChild(e),this.publish("receivedMessage",{message:"[system]: ".concat(t," left this conversation"),type:"system"})}},{key:"render",value:function(){var t=this;this.checkNewName(),this.addButton.addEventListener("click",function(){t.invalidName||t.addFrame(t.wrap,t.nameField.value.trim())}),window.addEventListener("message",function(e){e.data&&"object"!==_typeof(e.data)?t.publish("receivedMessage",{message:e.data,type:"user"}):e.data.hasOwnProperty("remove")&&t.removeFrame(e.data.remove)})}}]),o}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3N5c3RlbS5qcyJdLCJuYW1lcyI6WyJTeXN0ZW0iLCJidXR0b24iLCJ3cmFwcGVyIiwibmFtZUZpZWxkIiwiX3RoaXMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfZ2V0UHJvdG90eXBlT2YiLCJjYWxsIiwiYWRkQnV0dG9uIiwid3JhcCIsImlmcmFtZXMiLCJpbnZhbGlkTmFtZSIsIk1lZGlhdG9yIiwibGVuZ3RoIiwibmFtZSIsIl90aGlzMiIsImZyYW1lIiwiSUZyYW1lIiwiY29uY2F0IiwiY2hlY2tGcmFtZXNDb3VudCIsInJlbmRlcklmcmFtZSIsInB1c2giLCJhcHBlbmQiLCJzZXRUaW1lb3V0IiwicHVibGlzaCIsIm1lc3NhZ2UiLCJ0eXBlIiwiX3RoaXMzIiwiZXJyb3IiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwic29tZSIsInZhbHVlIiwidHJpbSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsImRlbGV0ZWQiLCJmaW5kIiwic3BsaWNlIiwiaW5kZXhPZiIsInJlbW92ZUNoaWxkIiwiX3RoaXM0IiwiY2hlY2tOZXdOYW1lIiwiYWRkRnJhbWUiLCJ3aW5kb3ciLCJkYXRhIiwiX3R5cGVvZiIsImhhc093blByb3BlcnR5IiwicmVtb3ZlRnJhbWUiXSwibWFwcGluZ3MiOiJBQUFBLGs2Q0FFTUEsbUJBQ0osU0FBQUEsRUFBWUMsRUFBUUMsRUFBU0MsR0FBVyxJQUFBQyxFQUFBLE9BQUFDLGdCQUFBQyxLQUFBTixJQUN0Q0ksRUFBQUcsMkJBQUFELEtBQUFFLGdCQUFBUixHQUFBUyxLQUFBSCxRQUNLSSxVQUFZVCxFQUNqQkcsRUFBS08sS0FBT1QsRUFDWkUsRUFBS0QsVUFBWUEsRUFDakJDLEVBQUtRLFFBQVUsR0FDZlIsRUFBS1MsYUFBYyxFQU5tQlQscUJBRHJCVSxtRUFXakIsT0FBT1IsS0FBS00sUUFBUUcsT0FBUyxtQ0FHdEJiLEVBQVNjLEdBQU0sSUFBQUMsRUFBQVgsS0FDaEJZLEVBQVEsSUFBSUMsT0FBT0gsR0FBSSxTQUFBSSxPQUFhZCxLQUFLZSxvQkFBc0JmLE1BQU1nQixlQUMzRWhCLEtBQUtNLFFBQVFXLEtBQUtMLEdBQ2xCaEIsRUFBUXNCLE9BQU9OLEdBQ2ZPLFdBQVcsV0FDVFIsRUFBS1MsUUFBUSxrQkFBbUIsQ0FDOUJDLFFBQU8sYUFBQVAsT0FBZUYsRUFBTUYsS0FBckIsNEJBQ1BZLEtBQU0sWUFFUCw0Q0FHVSxJQUFBQyxFQUFBdkIsS0FDUHdCLEVBQVFDLFNBQVNDLGNBQWMsVUFDckMxQixLQUFLSCxVQUFVOEIsaUJBQWlCLFFBQVMsV0FDdkNKLEVBQUtoQixZQUFjZ0IsRUFBS2pCLFFBQVFzQixLQUFLLFNBQUNoQixHQUNwQyxPQUFPQSxFQUFNRixPQUFTYSxFQUFLMUIsVUFBVWdDLE1BQU1DLFNBRTdDUCxFQUFLaEIsWUFBY2lCLEVBQU1PLFVBQVVDLElBQUksaUJBQW1CUixFQUFNTyxVQUFVRSxPQUFPLHVEQUl6RXZCLEdBQ1YsSUFBTXdCLEVBQVVsQyxLQUFLTSxRQUFRNkIsS0FBSyxTQUFDdkIsR0FDakMsR0FBSUEsRUFDRixPQUFPQSxFQUFNRixPQUFTQSxJQUcxQlYsS0FBS00sUUFBUThCLE9BQU9wQyxLQUFLTSxRQUFRK0IsUUFBUUgsR0FBVSxFQUFHLE1BQ3REbEMsS0FBS0ssS0FBS2lDLFlBQVlKLEdBQ3RCbEMsS0FBS29CLFFBQVEsa0JBQW1CLENBQzlCQyxRQUFPLGFBQUFQLE9BQWVKLEVBQWYsMkJBQ1BZLEtBQU0sNENBSUQsSUFBQWlCLEVBQUF2QyxLQUNQQSxLQUFLd0MsZUFDTHhDLEtBQUtJLFVBQVV1QixpQkFBaUIsUUFBUyxXQUNsQ1ksRUFBS2hDLGFBQ1JnQyxFQUFLRSxTQUFTRixFQUFLbEMsS0FBTWtDLEVBQUsxQyxVQUFVZ0MsTUFBTUMsVUFHbERZLE9BQU9mLGlCQUFpQixVQUFXLFNBQUNOLEdBQzlCQSxFQUFRc0IsTUFBZ0MsV0FBeEJDLFFBQU92QixFQUFRc0IsTUFDakNKLEVBQUtuQixRQUFRLGtCQUFtQixDQUM5QkMsUUFBU0EsRUFBUXNCLEtBQ2pCckIsS0FBTSxTQUVDRCxFQUFRc0IsS0FBS0UsZUFBZSxXQUNyQ04sRUFBS08sWUFBWXpCLEVBQVFzQixLQUFLViIsImZpbGUiOiJqcy9zeXN0ZW0ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuY2xhc3MgU3lzdGVtIGV4dGVuZHMgTWVkaWF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGJ1dHRvbiwgd3JhcHBlciwgbmFtZUZpZWxkKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5hZGRCdXR0b24gPSBidXR0b247XHJcbiAgICB0aGlzLndyYXAgPSB3cmFwcGVyO1xyXG4gICAgdGhpcy5uYW1lRmllbGQgPSBuYW1lRmllbGQ7XHJcbiAgICB0aGlzLmlmcmFtZXMgPSBbXTtcclxuICAgIHRoaXMuaW52YWxpZE5hbWUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGNoZWNrRnJhbWVzQ291bnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pZnJhbWVzLmxlbmd0aCArIDE7XHJcbiAgfVxyXG5cclxuICBhZGRGcmFtZSh3cmFwcGVyLCBuYW1lKSB7XHJcbiAgICBjb25zdCBmcmFtZSA9IG5ldyBJRnJhbWUobmFtZSB8fCBgaUZyYW1lJHt0aGlzLmNoZWNrRnJhbWVzQ291bnQoKX1gLCB0aGlzKS5yZW5kZXJJZnJhbWUoKTtcclxuICAgIHRoaXMuaWZyYW1lcy5wdXNoKGZyYW1lKTtcclxuICAgIHdyYXBwZXIuYXBwZW5kKGZyYW1lKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLnB1Ymxpc2goJ3JlY2VpdmVkTWVzc2FnZScsIHtcclxuICAgICAgICBtZXNzYWdlOiBgW3N5c3RlbV06ICR7ZnJhbWUubmFtZX0gam9pbmVkIHRoZSBjb252ZXJzYXRpb25gLFxyXG4gICAgICAgIHR5cGU6ICdzeXN0ZW0nXHJcbiAgICAgIH0pO1xyXG4gICAgfSwgMzAwKTtcclxuICB9XHJcblxyXG4gIGNoZWNrTmV3TmFtZSgpIHtcclxuICAgIGNvbnN0IGVycm9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVycm9yJyk7XHJcbiAgICB0aGlzLm5hbWVGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgdGhpcy5pbnZhbGlkTmFtZSA9IHRoaXMuaWZyYW1lcy5zb21lKChmcmFtZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBmcmFtZS5uYW1lID09PSB0aGlzLm5hbWVGaWVsZC52YWx1ZS50cmltKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLmludmFsaWROYW1lID8gZXJyb3IuY2xhc3NMaXN0LmFkZCgnZXJyb3ItLWFjdGl2ZScpIDogZXJyb3IuY2xhc3NMaXN0LnJlbW92ZSgnZXJyb3ItLWFjdGl2ZScpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVGcmFtZShuYW1lKSB7XHJcbiAgICBjb25zdCBkZWxldGVkID0gdGhpcy5pZnJhbWVzLmZpbmQoKGZyYW1lKSA9PiB7XHJcbiAgICAgIGlmIChmcmFtZSkge1xyXG4gICAgICAgIHJldHVybiBmcmFtZS5uYW1lID09PSBuYW1lO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuaWZyYW1lcy5zcGxpY2UodGhpcy5pZnJhbWVzLmluZGV4T2YoZGVsZXRlZCksIDAsIG51bGwpO1xyXG4gICAgdGhpcy53cmFwLnJlbW92ZUNoaWxkKGRlbGV0ZWQpO1xyXG4gICAgdGhpcy5wdWJsaXNoKCdyZWNlaXZlZE1lc3NhZ2UnLCB7XHJcbiAgICAgIG1lc3NhZ2U6IGBbc3lzdGVtXTogJHtuYW1lfSBsZWZ0IHRoaXMgY29udmVyc2F0aW9uYCxcclxuICAgICAgdHlwZTogJ3N5c3RlbSdcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgdGhpcy5jaGVja05ld05hbWUoKTtcclxuICAgIHRoaXMuYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuaW52YWxpZE5hbWUpIHtcclxuICAgICAgICB0aGlzLmFkZEZyYW1lKHRoaXMud3JhcCwgdGhpcy5uYW1lRmllbGQudmFsdWUudHJpbSgpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChtZXNzYWdlKSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlLmRhdGEgJiYgdHlwZW9mIG1lc3NhZ2UuZGF0YSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICB0aGlzLnB1Ymxpc2goJ3JlY2VpdmVkTWVzc2FnZScsIHtcclxuICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuZGF0YSxcclxuICAgICAgICAgIHR5cGU6ICd1c2VyJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZGF0YS5oYXNPd25Qcm9wZXJ0eSgncmVtb3ZlJykpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUZyYW1lKG1lc3NhZ2UuZGF0YS5yZW1vdmUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19

"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var System=function(e){function o(e,t,n){var r;return _classCallCheck(this,o),(r=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this))).addButton=e,r.wrap=t,r.nameField=n,r.iframes=[],r.invalidName=!1,r}return _inherits(o,Mediator),_createClass(o,[{key:"checkFramesCount",value:function(){return this.iframes.length+1}},{key:"addFrame",value:function(e,t){var n=this,r=new IFrame(t||"iFrame".concat(this.checkFramesCount()),this).renderIframe();this.iframes.push(r),e.append(r),setTimeout(function(){n.publish("receivedMessage",{message:"[system]: ".concat(r.name," joined the conversation"),type:"system"})},300)}},{key:"checkNewName",value:function(){var t=this,e=document.querySelector(".error");this.nameField.addEventListener("input",function(){t.invalidName=t.iframes.some(function(e){return e.name===t.nameField.value.trim()}),t.invalidName?e.classList.add("error--active"):e.classList.remove("error--active")})}},{key:"render",value:function(){var t=this;this.checkNewName(),this.addButton.addEventListener("click",function(){t.invalidName||t.addFrame(t.wrap,t.nameField.value.trim())}),window.addEventListener("message",function(e){e.data&&t.publish("receivedMessage",{message:e.data,type:"user"})})}}]),o}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3N5c3RlbS5qcyJdLCJuYW1lcyI6WyJTeXN0ZW0iLCJidXR0b24iLCJ3cmFwcGVyIiwibmFtZUZpZWxkIiwiX3RoaXMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfZ2V0UHJvdG90eXBlT2YiLCJjYWxsIiwiYWRkQnV0dG9uIiwid3JhcCIsImlmcmFtZXMiLCJpbnZhbGlkTmFtZSIsIk1lZGlhdG9yIiwibGVuZ3RoIiwibmFtZSIsIl90aGlzMiIsImZyYW1lIiwiSUZyYW1lIiwiY29uY2F0IiwiY2hlY2tGcmFtZXNDb3VudCIsInJlbmRlcklmcmFtZSIsInB1c2giLCJhcHBlbmQiLCJzZXRUaW1lb3V0IiwicHVibGlzaCIsIm1lc3NhZ2UiLCJ0eXBlIiwiX3RoaXMzIiwiZXJyb3IiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwic29tZSIsInZhbHVlIiwidHJpbSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIl90aGlzNCIsImNoZWNrTmV3TmFtZSIsImFkZEZyYW1lIiwid2luZG93IiwiZGF0YSJdLCJtYXBwaW5ncyI6IkFBQUEsazZDQUVNQSxtQkFDSixTQUFBQSxFQUFZQyxFQUFRQyxFQUFTQyxHQUFXLElBQUFDLEVBQUEsT0FBQUMsZ0JBQUFDLEtBQUFOLElBQ3RDSSxFQUFBRywyQkFBQUQsS0FBQUUsZ0JBQUFSLEdBQUFTLEtBQUFILFFBQ0tJLFVBQVlULEVBQ2pCRyxFQUFLTyxLQUFPVCxFQUNaRSxFQUFLRCxVQUFZQSxFQUNqQkMsRUFBS1EsUUFBVSxHQUNmUixFQUFLUyxhQUFjLEVBTm1CVCxxQkFEckJVLG1FQVdqQixPQUFPUixLQUFLTSxRQUFRRyxPQUFTLG1DQUd0QmIsRUFBU2MsR0FBTSxJQUFBQyxFQUFBWCxLQUNoQlksRUFBUSxJQUFJQyxPQUFPSCxHQUFJLFNBQUFJLE9BQWFkLEtBQUtlLG9CQUFzQmYsTUFBTWdCLGVBQzNFaEIsS0FBS00sUUFBUVcsS0FBS0wsR0FDbEJoQixFQUFRc0IsT0FBT04sR0FDZk8sV0FBVyxXQUNUUixFQUFLUyxRQUFRLGtCQUFtQixDQUM5QkMsUUFBTyxhQUFBUCxPQUFlRixFQUFNRixLQUFyQiw0QkFDUFksS0FBTSxZQUVQLDRDQUdVLElBQUFDLEVBQUF2QixLQUNQd0IsRUFBUUMsU0FBU0MsY0FBYyxVQUNyQzFCLEtBQUtILFVBQVU4QixpQkFBaUIsUUFBUyxXQUN2Q0osRUFBS2hCLFlBQWNnQixFQUFLakIsUUFBUXNCLEtBQUssU0FBQ2hCLEdBQ3BDLE9BQU9BLEVBQU1GLE9BQVNhLEVBQUsxQixVQUFVZ0MsTUFBTUMsU0FFN0NQLEVBQUtoQixZQUFjaUIsRUFBTU8sVUFBVUMsSUFBSSxpQkFBbUJSLEVBQU1PLFVBQVVFLE9BQU8sb0RBSTVFLElBQUFDLEVBQUFsQyxLQUNQQSxLQUFLbUMsZUFDTG5DLEtBQUtJLFVBQVV1QixpQkFBaUIsUUFBUyxXQUNsQ08sRUFBSzNCLGFBQ1IyQixFQUFLRSxTQUFTRixFQUFLN0IsS0FBTTZCLEVBQUtyQyxVQUFVZ0MsTUFBTUMsVUFHbERPLE9BQU9WLGlCQUFpQixVQUFXLFNBQUNOLEdBQzlCQSxFQUFRaUIsTUFDVkosRUFBS2QsUUFBUSxrQkFBbUIsQ0FDOUJDLFFBQVNBLEVBQVFpQixLQUNqQmhCLEtBQU0iLCJmaWxlIjoianMvc3lzdGVtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmNsYXNzIFN5c3RlbSBleHRlbmRzIE1lZGlhdG9yIHtcclxuICBjb25zdHJ1Y3RvcihidXR0b24sIHdyYXBwZXIsIG5hbWVGaWVsZCkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuYWRkQnV0dG9uID0gYnV0dG9uO1xyXG4gICAgdGhpcy53cmFwID0gd3JhcHBlcjtcclxuICAgIHRoaXMubmFtZUZpZWxkID0gbmFtZUZpZWxkO1xyXG4gICAgdGhpcy5pZnJhbWVzID0gW107XHJcbiAgICB0aGlzLmludmFsaWROYW1lID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBjaGVja0ZyYW1lc0NvdW50KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaWZyYW1lcy5sZW5ndGggKyAxO1xyXG4gIH1cclxuXHJcbiAgYWRkRnJhbWUod3JhcHBlciwgbmFtZSkge1xyXG4gICAgY29uc3QgZnJhbWUgPSBuZXcgSUZyYW1lKG5hbWUgfHwgYGlGcmFtZSR7dGhpcy5jaGVja0ZyYW1lc0NvdW50KCl9YCwgdGhpcykucmVuZGVySWZyYW1lKCk7XHJcbiAgICB0aGlzLmlmcmFtZXMucHVzaChmcmFtZSk7XHJcbiAgICB3cmFwcGVyLmFwcGVuZChmcmFtZSk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5wdWJsaXNoKCdyZWNlaXZlZE1lc3NhZ2UnLCB7XHJcbiAgICAgICAgbWVzc2FnZTogYFtzeXN0ZW1dOiAke2ZyYW1lLm5hbWV9IGpvaW5lZCB0aGUgY29udmVyc2F0aW9uYCxcclxuICAgICAgICB0eXBlOiAnc3lzdGVtJ1xyXG4gICAgICB9KTtcclxuICAgIH0sIDMwMCk7XHJcbiAgfVxyXG5cclxuICBjaGVja05ld05hbWUoKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lcnJvcicpO1xyXG4gICAgdGhpcy5uYW1lRmllbGQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuaW52YWxpZE5hbWUgPSB0aGlzLmlmcmFtZXMuc29tZSgoZnJhbWUpID0+IHtcclxuICAgICAgICByZXR1cm4gZnJhbWUubmFtZSA9PT0gdGhpcy5uYW1lRmllbGQudmFsdWUudHJpbSgpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5pbnZhbGlkTmFtZSA/IGVycm9yLmNsYXNzTGlzdC5hZGQoJ2Vycm9yLS1hY3RpdmUnKSA6IGVycm9yLmNsYXNzTGlzdC5yZW1vdmUoJ2Vycm9yLS1hY3RpdmUnKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgdGhpcy5jaGVja05ld05hbWUoKTtcclxuICAgIHRoaXMuYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuaW52YWxpZE5hbWUpIHtcclxuICAgICAgICB0aGlzLmFkZEZyYW1lKHRoaXMud3JhcCwgdGhpcy5uYW1lRmllbGQudmFsdWUudHJpbSgpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChtZXNzYWdlKSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlLmRhdGEpIHtcclxuICAgICAgICB0aGlzLnB1Ymxpc2goJ3JlY2VpdmVkTWVzc2FnZScsIHtcclxuICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuZGF0YSxcclxuICAgICAgICAgIHR5cGU6ICd1c2VyJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19
